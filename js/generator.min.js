"use strict";function setState(n,t,i,r,u){var f;n!==f&&(btnHide.textContent=n?"Show":"Hide");i!==f&&(btnHide.disabled=i);t!==f&&(btnChoose.disabled=t);r!==f&&(btnRedo.disabled=r);u!==f&&(btnReset.disabled=u)}function resetGenerator(){console.log("Reset");DATA.reset(SETTINGS);setState(!1,!0,!0,!0,!0);SETTINGS.resetHowManyToSelect();OUTPUT.message("List reset.");OUTPUT.status()}var NOT_RESET=0,btnChoose,btnReset,btnHide,btnRedo,DATA=function(){var n=[],e=[],t=[],r=[],i=[],u=[],f={};return{init:function(n){n.forEach(function(n){u.push(n.name);f[n.name]=n});u.sort()},getNames:function(){return u?u.slice(0):[]},getByName:function(n){return f[n]},exclude:function(n){e=n.slice(0).sort()},getExcludedNames:function(){return e.slice(0)},getGivenNames:function(){return r.slice(0)},getSelectedNames:function(){return t.slice(0)},select:function(r){var c=Math.floor(Math.random()*n.length),u,o,s,e,h;if(n[c]){if(u=n.splice(c,1)[0],t.push(u),t.sort(),o=f[u],r&&o.restriction)for(s=o.restriction.split(","),e=0;e<s.length;e++)h=n.indexOf(s[e]),h>-1&&i.push(n.splice(h,1)[0]);return u}},undo:function(){n=n.concat(t,i);n.sort();t=[];i=[]},next:function(){r=r.concat(t,i).sort();i=[];t=[]},getOutOfPoolSize:function(){return t.length+r.length+i.length},getPoolSize:function(){return n.length},reset:function(o){n=u.filter(function(n){var t=f[n];return o.isComplexity(t.level)&&o.isGame(t.game)&&e.indexOf(t.name)<=0&&(o.getSetupAllowed()===0||t.setup===undefined||o.getSetupAllowed()===1&&t.setup!=="color")});r=[];t=[];i=[]}}}(),SETTINGS=function(n){var i=window.localStorage,h=document.getElementById("choose"),f=[!0,!0,!0],s=["Green","Yellow","Red"],r={E:!0},e=!0,t=2,o=0,u=function(n,t){i&&(typeof t!="string"&&(t=JSON.stringify(t)),i.setItem(n,t))};return{load:function(){if(i)try{var u=JSON.parse(i.games);u&&(r=u,Object.keys(r).forEach(function(n){document.getElementById("game"+n).checked=r[n]}));u=JSON.parse(i.levels);u&&(f=u,s.forEach(function(n,t){document.getElementById(n).checked=f[t]}));u=i.choose;u&&(t=u,document.getElementById("choose").value=t);u=i.preventConflict;u!==undefined&&u!==null&&(e=u=="true",document.getElementById("preventConflict").checked=e);u=JSON.parse(i.exclude);u&&n.exclude(u);u=i.setup;u&&(o=parseInt(u,10),$("#setup"+o).trigger("click"))}catch(h){i.clear();OUTPUT.message("Could not load settings. Resetting to defaults.")}},exclude:function(n){u("exclude",n)},isGame:function(n){return r[n]},setGame:function(n,t){r[n]=t;u("games",r)},isComplexity:function(n){return f[n]},setComplexity:function(n,t){f[s.indexOf(n)]=t;u("levels",f)},restrictConflicts:function(n){return n!==undefined&&(e=n,u("preventConflict",e)),e},setSetupAllowed:function(n){o=n;u("setup",o)},getSetupAllowed:function(){return o},howManyToGive:function(){return t},resetHowManyToSelect:function(i){i&&(t=i);var r=n.getPoolSize();return r>0&&t>r&&(t=r),t<1&&(t=1),u("choose",t),h.value=t,setState(undefined,r<t,undefined,undefined,undefined),t}}}(DATA),OUTPUT=function(n){function r(n){var t=i[n.level];return'<div class="panel panel-'+t+'"><div class="panel-heading">'+n.name+" "+u(n)+'<span class="clearfix"><\/span><\/div><div class="panel-body"><a href="#" class="pull-right btn btn-sm btn-'+t+'">+<\/a>'+n.power+'<\/div><div class="panel-footer" style="display:none;">'+n.description+"<\/div><\/div>"}function u(n){for(var f,t=i[n.level],r=' <span class="pull-right label label-'+t+'">',u=0;u<=n.level;u++)r+="★";return r+="<\/span>",f=n.setup||n.restriction?'<span class="pull-right label label-'+t+'">!<\/span>':"",'<span class="pull-right label label-'+t+'">C'+n.game.slice(0,1)+"<\/span>"+r+f}var t=document.getElementById("output"),f=document.getElementById("numbers"),i={2:"danger",1:"warning",0:"success"};return{message:function(n){NOT_RESET=0;t.innerHTML='<div class="col-sm-offset-1 col-md-offset-2 col-sm-10 col-md-8">'+n+"<\/div>"},aliens:function(i,u){var e=i.map(n.getByName),o=Math.ceil(e.length/2),f="";u&&(f+='<p class="col-sm-offset-1 col-md-offset-2 col-sm-10 col-md-8">'+u+'<\/p><\/div><div class="row">');f+='<div class="col-sm-offset-1 col-md-offset-2 col-sm-5 col-md-4">'+e.slice(0,o).map(function(n){return r(n)}).join("")+"<\/div>";f+='<div class="col-sm-5 col-md-4">'+e.slice(o).map(function(n){return r(n)}).join("")+"<\/div>";t.innerHTML=f;NOT_RESET=0},status:function(){var t=n.getOutOfPoolSize();f.textContent=t+" of "+(t+n.getPoolSize())+" aliens picked."},excludeOption:function(t){if(!t.id)return t.text;var i=t.text;return $(u(n.getByName(i))+'<span class="alien-name">'+i+"<\/span>")}}}(DATA);$(function(){$("#choose").on("change",function(){SETTINGS.resetHowManyToSelect(this.value)})[0];$("#Complexities").on("click","input",function(){SETTINGS.setComplexity(this.id,this.checked);resetGenerator()});$("#Games").on("click","input",function(){SETTINGS.setGame(this.id[4],this.checked);resetGenerator()});$("input[type=radio][name=excludeSetup]").on("change",function(){SETTINGS.setSetupAllowed(parseInt(this.value,10));resetGenerator()});$("#preventConflict").on("click",function(){SETTINGS.restrictConflicts(this.checked)});btnReset=$("#reset").on("click",function(){confirm("Reset list of aliens?")?resetGenerator():NOT_RESET++;NOT_RESET>2&&(DATA.next(),OUTPUT.aliens(DATA.getGivenNames(),"Aliens given out so far:"),setState(!1,undefined,!1,!0,undefined))})[0];btnHide=$("#hide").on("click",function(){var n=DATA.getSelectedNames(),t;if(btnHide.textContent==="Hide"){setState(n.length,undefined,!n.length,!0,undefined);OUTPUT.message("Choices hidden.");return}if(t=n.map(function(n){return n[0].toLowerCase()}),t.indexOf((prompt("Enter the first initial of one of the aliens you were given, then click OK.")||"").toLowerCase())<0){OUTPUT.message("Wrong letter.");return}OUTPUT.aliens(n);setState(!1,undefined,undefined,!1,undefined)})[0];btnChoose=$("#newAliens").on("click",function(){var n,t,r,i;for(DATA.next(),n=SETTINGS.howManyToGive(),t=0;t<n;t++)if(r=DATA.select(SETTINGS.restrictConflicts()),!r)break;if(i=DATA.getSelectedNames(),i.length<n){DATA.undo();OUTPUT.message("Not enough potential aliens left."+(SETTINGS.restrictConflicts()?' It\'s possible that the "Prevent conflicts" option is preventing me from displaying remaining aliens.':""));setState(undefined,!0,!0,undefined,undefined);return}OUTPUT.status();OUTPUT.aliens(i);setState(!1,undefined,!1,!1,!1);SETTINGS.resetHowManyToSelect();return})[0];btnRedo=$("#redo").on("click",function(){confirm("Redo?")&&(DATA.undo(),$(btnChoose).trigger("click"))})[0];$("#output").on("click","a",function(n){var t=$(this);return t.text(t.text()==="+"?"-":"+").parent().next().toggle(),n.preventDefault(),!1});$.getJSON("data/aliens.json").done(function(n){DATA.init(n);SETTINGS.load();$("#exclude").append(DATA.getNames().map(function(n){return new Option(n,n)})).val(DATA.getExcludedNames()).on("change",function(){var n=$(this).val()||[];DATA.exclude(n);SETTINGS.exclude(n);resetGenerator()}).select2({placeholder:"None selected",templateResult:OUTPUT.excludeOption});resetGenerator()}).fail(function(){OUTPUT.message("Unable to load data. Refresh to try again.")})});
//# sourceMappingURL=generator.min.js.map
