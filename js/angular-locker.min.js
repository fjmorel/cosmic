/**
 * angular-locker
 *
 * A simple & configurable abstraction for local/session storage in angular projects.
 *
 * @link https://github.com/tymondesigns/angular-locker
 * @author Sean Tymon @tymondesigns
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n,t){typeof define=="function"&&define.amd?define(function(){return t(n.angular)}):typeof exports=="object"?module.exports=t(n.angular||window&&window.angular):t(n.angular)})(this,function(n){"use strict";n.module("angular-locker",[]).provider("locker",function(){var i=function(t,i){return n.isFunction(t)?t(i):t},u=function(n,t){return Object.keys(n).filter(function(i){return n[i]===t})[0]},r=function(n){throw new Error("[angular-locker] "+n);},t={driver:"local",namespace:"locker",eventsEnabled:!0,separator:"."};return{setDefaultDriver:function(n){return t.driver=i(n),this},getDefaultDriver:function(){return t.driver},setDefaultNamespace:function(n){return t.namespace=i(n),this},getDefaultNamespace:function(){return t.namespace},setEventsEnabled:function(n){return t.eventsEnabled=i(n),this},getEventsEnabled:function(){return t.eventsEnabled},setSeparator:function(n){return t.separator=i(n),this},getSeparator:function(){return t.separator},$get:["$window","$rootScope","$parse",function(f,e,o){function s(o,s){this._registeredDrivers={local:f.localStorage,session:f.sessionStorage};this._resolveDriver=function(n){return this._registeredDrivers.hasOwnProperty(n)||r('The driver "'+n+'" was not found.'),this._registeredDrivers[n]};this._deriveDriver=function(n){return u(this._registeredDrivers,n)};this._driver=this._resolveDriver(o);this._namespace=s;this._eventsEnabled=t.eventsEnabled;this._separator=t.separator;this._watchers={};this._checkSupport=function(t){if(n.isUndefined(this._supported)){var i="l";try{this._resolveDriver(t||"local").setItem(i,i);this._resolveDriver(t||"local").removeItem(i);this._supported=!0}catch(r){this._supported=!1}}return this._supported};this._getPrefix=function(n){return this._namespace?this._namespace+this._separator+n:n};this._serialize=function(t){try{return n.toJson(t)}catch(i){return t}};this._unserialize=function(t){try{return n.fromJson(t)}catch(i){return t}};this._event=function(t,i){this._eventsEnabled&&e.$emit(t,n.extend(i,{driver:this._deriveDriver(this._driver),namespace:this._namespace}))};this._setItem=function(t,i){this._checkSupport()||r("The browser does not support localStorage");try{var u=this._getItem(t);this._driver.setItem(this._getPrefix(t),this._serialize(i));this._exists(t)&&!n.equals(u,i)?this._event("locker.item.updated",{key:t,oldValue:u,newValue:i}):this._event("locker.item.added",{key:t,value:i})}catch(f){["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError"].indexOf(f.name)!==-1?r("The browser storage quota has been exceeded"):r('Could not add item with key "'+t+'"')}};this._getItem=function(n){return this._checkSupport()||r("The browser does not support localStorage"),this._unserialize(this._driver.getItem(this._getPrefix(n)))};this._exists=function(n){return this._checkSupport()||r("The browser does not support localStorage"),this._driver.hasOwnProperty(this._getPrefix(i(n)))};this._removeItem=function(n){return(this._checkSupport()||r("The browser does not support localStorage"),!this._exists(n))?!1:(this._driver.removeItem(this._getPrefix(n)),this._event("locker.item.forgotten",{key:n}),!0)}}return s.prototype={put:function(t,r){if(!t)return!1;if(t=i(t),n.isObject(t))n.forEach(t,function(n,t){this._setItem(t,n)},this);else{if(!n.isDefined(r))return!1;this._setItem(t,i(r,this._getItem(t)))}return this},add:function(n,t){return this.has(n)?!1:(this.put(n,t),!0)},get:function(t,i){if(n.isArray(t)){var r={};return n.forEach(t,function(n){this.has(n)&&(r[n]=this._getItem(n))},this),r}return this.has(t)?this._getItem(t):arguments.length===2?i:void 0},has:function(n){return this._exists(n)},forget:function(t){return t=i(t),n.isArray(t)?t.map(this._removeItem,this):this._removeItem(t),this},pull:function(n,t){var i=this.get(n,t);return this.forget(n),i},all:function(){var t={};return n.forEach(this._driver,function(n,i){var r=i.split(this._separator);r.length>1&&r[0]===this._namespace&&(r.splice(0,1),i=r.join(this._separator));this.has(i)&&(t[i]=this.get(i))},this),t},clean:function(){return this.forget(Object.keys(this.all())),this},empty:function(){return this._driver.clear(),this},count:function(){return Object.keys(this.all()).length},bind:function(t,i,r){n.isUndefined(t.$eval(i))&&(o(i).assign(t,this.get(i,r)),this.has(i)||this.put(i,r));var u=this;return this._watchers[i+t.$id]=t.$watch(i,function(t){n.isDefined(t)&&u.put(i,t)},n.isObject(t[i])),this},unbind:function(n,t){o(t).assign(n,void 0);this.forget(t);var i=t+n.$id;return this._watchers[i]&&(this._watchers[i](),delete this._watchers[i]),this},driver:function(n){return this.instance(n,this._namespace)},getDriver:function(){return this._driver},namespace:function(n){return this.instance(this._deriveDriver(this._driver),n)},getNamespace:function(){return this._namespace},supported:function(n){return this._checkSupport(n)},instance:function(n,t){return new s(n,t)}},new s(t.driver,t.namespace)}]}})});
//# sourceMappingURL=angular-locker.min.js.map
