!function(){"use strict";var a=angular.module("cc.aliens.generator",["ngAria","cc.base","cc.aliens","ngStorage","ngMaterial","ngMdIcons"]);a.constant("generatorVersion",2),a.controller("NavDrawer",["$scope","$mdSidenav",function(a,b){a.close=function(){b("left").close()},a.open=function(){b("left").open()}}]),a.controller("GeneratorCtrl",["$scope","alienData","$localStorage","$sessionStorage","generatorVersion",function(a,b,c,d,e){var f=this,g={complexities:[!0,!0,!0],games:{E:!0},namesExcluded:[],setupLevel:"none",numToChoose:2,preventConflicts:!0,version:1};c.$default(g),(!c.version||c.version<e)&&(c.$reset(g),c.version=e),a.settings=c,a.complexities=c.complexities,a.namesExcluded=c.namesExcluded,a.setupLevel=c.setupLevel,a.numToChoose=c.numToChoose,f.state="Loading aliens...",a.aliensToShow=[],a.aliensAll=[];var h=[],i=[],j=[],k=[];a.namesAll=[],a.numOut=function(){return h.length+i.length+j.length},a.numCurrent=function(){return h.length},a.numGiven=function(){return i.length},a.numRestricted=function(){return j.length},a.numLeft=function(){return k.length},a.aliens;var l=function(){var c=a.settings;k=a.namesAll.filter(function(d){var e=b.get(d);return c.complexities[e.level]&&c.games[e.game]&&a.namesExcluded.indexOf(d)<0&&("none"===a.setupLevel||void 0===e.setup||"color"===a.setupLevel&&"color"!==e.setup)}),i=[],h=[],j=[],f.restrictNumToChoose(),f.state="List reset.",a.aliensToShow=[]};f.onExcludeChange=function(){a.namesExcluded=a.excluded.map(function(a){return a.name}),f.saveSetting("namesExcluded")},f.saveSetting=function(b){c[b]=a[b],l()};var m=function(){var c=Math.floor(Math.random()*k.length);if(k[c]){var d=k.splice(c,1)[0];h.push(d),h.sort();var e=b.get(d);if(a.settings.preventConflicts&&e.restriction)for(var f=e.restriction.split(","),g=0;g<f.length;g++){var i=k.indexOf(f[g]);i>-1&&j.push(k.splice(i,1)[0])}return d}},n=function(){i=i.concat(h,j).sort(),j=[],h=[]},o=function(){k=k.concat(h,j),k.sort(),h=[],j=[]},p=0;f.reset=function(){confirm("Reset list of aliens?")?l():p++,p>2&&(n(),f.state="Aliens given out so far:",a.aliensToShow=i.map(b.get),p=0)},f.restrictNumToChoose=function(){var b=a.settings.numToChoose,d=a.numLeft();d>0&&b>d&&(b=d),1>b&&(b=1),a.settings.numToChoose=b,c.numToChoose=b},f.pickAliens=function(){n();for(var c=a.settings.numToChoose,d=0;c>d;d++){var e=m();if(!e)break}return h.length<c?(o(),a.aliensToShow=[],void(f.state="Not enough potential aliens left."+(a.settings.preventConflicts?' It\'s possible that the "Prevent conflicts" option is preventing me from displaying remaining aliens.':""))):(f.state="Choices:",a.aliensToShow=h.map(b.get),void f.restrictNumToChoose())},f.hide=function(){a.aliensToShow=[],f.state="Choices hidden."},f.show=function(){var c=h.map(function(a){return a[0].toLowerCase()});return c.indexOf((prompt("Enter the first initial of one of the aliens you were given, then click OK.")||"").toLowerCase())<0?void(f.state="Wrong letter."):(f.state="Choices:",void(a.aliensToShow=h.map(b.get)))},f.redo=function(){confirm("Redo?")&&(o(),f.pickAliens())},b.init().then(function(c){a.namesAll=a.namesAll.concat(c),a.aliensAll=a.namesAll.map(b.get),a.excluded=a.aliensAll.filter(function(b){return a.namesExcluded.indexOf(b.name)>-1}),l()})["catch"](function(a){})}])}();