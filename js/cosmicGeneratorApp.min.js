(function(){"use strict";var n=angular.module("cosmicApp",["cosmicAliens","ngStorage","ui.select"]);n.controller("GeneratorCtrl",["$scope","alienData","$localStorage","$sessionStorage",function(n,t,i){function s(){var i=n.settings;u=n.namesAll.filter(function(r){var u=t.get(r);return i.complexities[u.level]&&i.games[u.game]&&n.namesExcluded.indexOf(r)<0&&(n.setupLevel==="0"||u.setup===undefined||n.setupLevel==="1"&&u.setup!=="color")});e=[];r=[];f=[];n.restrictNumToChoose();n.message="List reset.";n.aliensToShow=[]}var o;i.$default({complexities:[!0,!0,!0],games:{E:!0},namesExcluded:[],setupLevel:"0",numToChoose:2,preventConflicts:!0});n.settings=i;n.complexities=i.complexities;n.namesExcluded=i.namesExcluded;n.setupLevel=i.setupLevel;n.numToChoose=i.numToChoose;n.message="Loading aliens...";n.aliensToShow=[];var r=[],e=[],f=[],u=[];n.namesAll=[];n.numCurrent=function(){return r.length};n.numGiven=function(){return e.length};n.numRestricted=function(){return f.length};n.numLeft=function(){return u.length};n.restrictNumToChoose=function(){var t=n.numToChoose,r=n.numLeft();r>0&&t>r&&(t=r);t<1&&(t=1);n.numToChoose=t;i.numToChoose=t};n.onExcludeSelect=function(t){n.namesExcluded.push(t.name);n.onSettingChange("namesExcluded")};n.onExcludeRemove=function(t){var i=n.namesExcluded.indexOf(t.name);i>-1&&n.namesExcluded.splice(i,1);n.onSettingChange("namesExcluded")};n.onSettingChange=function(t){i[t]=n[t];s()};o=0;n.reset=function(){confirm("Reset list of aliens?")?s():o++;o>2&&(h(),n.message="Aliens given out so far:",n.aliensToShow=e.map(t.get),o=0)};var h=function(){e=e.concat(r,f).sort();f=[];r=[]},c=function(){u=u.concat(r,f);u.sort();r=[];f=[]},l=function(){var c=Math.floor(Math.random()*u.length),i,o,s,e,h;if(u[c]){if(i=u.splice(c,1)[0],r.push(i),r.sort(),o=t.get(i),n.settings.preventConflicts&&o.restriction)for(s=o.restriction.split(","),e=0;e<s.length;e++)h=u.indexOf(s[e]),h>-1&&f.push(u.splice(h,1)[0]);return i}};n.pickAliens=function(){var i,u,f;for(h(),i=n.numToChoose,u=0;u<i;u++)if(f=l(),!f)break;if(r.length<i){c();n.aliensToShow=[];n.message="Not enough potential aliens left."+(n.settings.preventConflicts?' It\'s possible that the "Prevent conflicts" option is preventing me from displaying remaining aliens.':"");return}n.message="Choices:";n.aliensToShow=r.map(t.get);n.restrictNumToChoose();return};n.hide=function(){n.aliensToShow=[];n.message="Choices hidden."};n.show=function(){var i=r.map(function(n){return n[0].toLowerCase()});if(i.indexOf((prompt("Enter the first initial of one of the aliens you were given, then click OK.")||"").toLowerCase())<0){n.message="Wrong letter.";return}n.message="Choices:";n.aliensToShow=r.map(t.get)};n.redo=function(){confirm("Redo?")&&(c(),n.pickAliens())};t.onLoaded(function(){n.namesAll=t.getNames().sort();n.aliensAll=n.namesAll.map(function(n){return t.get(n)});s()})}])})();
//# sourceMappingURL=cosmicGeneratorApp.min.js.map
