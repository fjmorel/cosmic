"use strict";!function(){var a=angular.module("cc.aliens.generator",["ngAria","cc.base","cc.aliens","ngStorage","ngMaterial"]);a.constant("generatorVersion",2),a.service("GeneratorService",["alienData",function(a){var b={},c=[],d=[],e=[],f=[];b.reset=function(b,g,h,i){return f=a.getMatchingNames(b,g,h,i),d=[],c=[],e=[],{aliens:[],message:"List reset."}};var g=function(b){var d=Math.floor(Math.random()*f.length);if(f[d]){var g=f.splice(d,1)[0];c.push(g),c.sort();var h=a.get(g);if(b&&h.restriction)for(var i=h.restriction.split(","),j=0;j<i.length;j++){var k=f.indexOf(i[j]);k>-1&&e.push(f.splice(k,1)[0])}return g}},h=function(){d=d.concat(c,e),e=[],c=[]},i=function(){f=f.concat(c,e),f.sort(),c=[],e=[]};return b.getAllGiven=function(){return h(),{aliens:d.sort().map(a.get),message:"Aliens given out so far:"}},b.getChooseLimit=function(a){var b=a,c=f.length;return c>0&&b>c&&(b=c),1>b&&(b=1),b},b.draw=function(d){h();for(var e=0;d>e;e++){var f=g();if(!f)break}return c.length<d?(i(),{aliens:[],message:"Not enough potential aliens left."+(b.settings.preventConflicts?' It\'s possible that the "Prevent conflicts" option is preventing me from displaying remaining aliens.':"")}):{aliens:c.map(a.get),message:"Choices:",limit:b.getChooseLimit(d)}},b.hide=function(){return{aliens:[],state:"Choices hidden."}},b.show=function(){var b=c.map(function(a){return a[0].toLowerCase()});return b.indexOf((prompt("Enter the first initial of one of the aliens you were given, then click OK.")||"").toLowerCase())<0?{aliens:[],state:"Wrong letter."}:{aliens:c.map(a.get),message:"Choices:"}},b.redo=function(a){return confirm("Redo?")?(i(),b.draw(a)):void 0},b.getDisabledActions=function(a,b){return{draw:f.length<a,hide:1>b,show:!(c.length>0&&1>b),redo:c.length<=0||0>=b,reset:c.length<=0&&d.length<=0}},b.getStatus=function(){return c.length+d.length+e.length+" of "+(c.length+d.length+e.length+f.length)+" drawn."},b.init=a.init,b}]),a.controller("GeneratorCtrl",["$localStorage","generatorVersion","GeneratorService",function(a,b,c){var d=this,e={complexities:[!0,!0,!0],games:{E:!0},namesExcluded:[],setupLevel:"none",numToChoose:2,preventConflicts:!0,version:2};a.$default(e),(!a.version||a.version<b)&&(a.$reset(e),a.version=b),d.settings=a,d.status="0 of 0 drawn.",d.state="Loading aliens...",d.aliensToShow=[],d.disabled={draw:!0,hide:!0,show:!0,redo:!0,reset:!0};var f=function(b){b&&(d.state=b.message,d.aliensToShow=b.aliens,b.limit&&(d.settings.numToChoose=b.limit,a.numToChoose=b.limit),d.status=c.getStatus(),d.disabled=c.getDisabledActions(d.settings.numToChoose,d.aliensToShow.length))},g=function(){var a=d.settings;f(c.reset(a.complexities,a.games,a.namesExcluded,a.setupLevel)),d.restrictNumToChoose()};d.saveSetting=function(b){a[b]=d.settings[b],g()};var h=0;d.reset=function(){confirm("Reset list of aliens?")?g():h++,h>2&&(f(c.getAllGiven()),h=0)},d.restrictNumToChoose=function(){d.settings.numToChoose=c.getChooseLimit(d.settings.numToChoose),a.numToChoose=d.settings.numToChoose},d.draw=function(){f(c.draw(d.settings.numToChoose))},d.hide=function(){f(c.hide())},d.show=function(){f(c.show())},d.redo=function(){f(c.redo(d.settings.numToChoose))},c.init().then(function(a){d.namesAll=a,g()})}]),angular.bootstrap(document,["cc.aliens.generator"],{strictDi:!0})}();