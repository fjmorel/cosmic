"use strict";!function(){var a=angular.module("cc.aliens.generator",["ngAria","cc.base","cc.aliens","ngStorage","ngMaterial","ngMdIcons"]);a.constant("generatorVersion",2),a.controller("GeneratorCtrl",["$scope","alienData","$localStorage","$sessionStorage","generatorVersion",function(a,b,c,d,e){var f=this,g={complexities:[!0,!0,!0],games:{E:!0},namesExcluded:[],setupLevel:"none",numToChoose:2,preventConflicts:!0,version:1};c.$default(g),(!c.version||c.version<e)&&(c.$reset(g),c.version=e),f.settings=c,f.complexities=c.complexities,f.namesExcluded=c.namesExcluded,f.setupLevel=c.setupLevel,f.numToChoose=c.numToChoose,f.state="Loading aliens...",f.aliensToShow=[];var h=[],i=[],j=[],k=[];f.namesAll=[],f.numOut=function(){return h.length+i.length+j.length},f.numCurrent=function(){return h.length},f.numGiven=function(){return i.length},f.numLeft=function(){return k.length};var l=function(){var a=f.settings;k=b.getMatchingNames(a.complexities,a.games,f.namesExcluded,f.setupLevel),i=[],h=[],j=[],f.restrictNumToChoose(),f.state="List reset.",f.aliensToShow=[]};f.saveSetting=function(a){c[a]=f[a],l()};var m=function(){var a=Math.floor(Math.random()*k.length);if(k[a]){var c=k.splice(a,1)[0];h.push(c),h.sort();var d=b.get(c);if(f.settings.preventConflicts&&d.restriction)for(var e=d.restriction.split(","),g=0;g<e.length;g++){var i=k.indexOf(e[g]);i>-1&&j.push(k.splice(i,1)[0])}return c}},n=function(){i=i.concat(h,j).sort(),j=[],h=[]},o=function(){k=k.concat(h,j),k.sort(),h=[],j=[]},p=0;f.reset=function(){confirm("Reset list of aliens?")?l():p++,p>2&&(n(),f.state="Aliens given out so far:",f.aliensToShow=i.map(b.get),p=0)},f.restrictNumToChoose=function(){var a=f.settings.numToChoose,b=f.numLeft();b>0&&a>b&&(a=b),1>a&&(a=1),f.settings.numToChoose=a,c.numToChoose=a},f.pickAliens=function(){n();for(var a=f.settings.numToChoose,c=0;a>c;c++){var d=m();if(!d)break}return h.length<a?(o(),f.aliensToShow=[],void(f.state="Not enough potential aliens left."+(f.settings.preventConflicts?' It\'s possible that the "Prevent conflicts" option is preventing me from displaying remaining aliens.':""))):(f.state="Choices:",f.aliensToShow=h.map(b.get),void f.restrictNumToChoose())},f.hide=function(){f.aliensToShow=[],f.state="Choices hidden."},f.show=function(){var a=h.map(function(a){return a[0].toLowerCase()});return a.indexOf((prompt("Enter the first initial of one of the aliens you were given, then click OK.")||"").toLowerCase())<0?void(f.state="Wrong letter."):(f.state="Choices:",void(f.aliensToShow=h.map(b.get)))},f.redo=function(){confirm("Redo?")&&(o(),f.pickAliens())},b.init().then(function(a){f.namesAll=f.namesAll.concat(a),l()})["catch"](function(a){})}]),angular.bootstrap(document,["cc.aliens.generator"],{strictDi:!0})}();